
services:
  # -----------------------------
  # Backend Development Container
  # -----------------------------
  mydesktop-server:
    image: node:20-alpine
    working_dir: /app/server
    ports:
      - "3009:3009"
    volumes:
      # Mount the root to access shared workspaces
      - ./:/app
      # Avoid overwriting container node_modules with local ones
      - /app/node_modules
      - /app/server/node_modules
      - /app/client/node_modules
    environment:
      - PORT=3009
    hostname: mydesktop-server
    container_name: mydesktop-server
    # Install root deps (for workspaces) then start server dev mode
    command: sh -c "npm install && npm run dev --workspace=server"

  # -----------------------------
  # Frontend Development Container
  # -----------------------------
  mydesktop-client:
    image: node:20-alpine
    working_dir: /app/client
    ports:
      - 3010:3010
    volumes:
      - ./:/app
      - /app/node_modules
      - /app/server/node_modules
      - /app/client/node_modules
    environment:
      # Point Vite to the backend container name
      - VITE_API_TARGET=http://mydesktop-server:3009
    depends_on:
      - mydesktop-server
    hostname: mydesktop-client
    container_name: mydesktop-client
    # Install (in case server didn't finish) then start vite
    command: sh -c "npm install && npm run dev --workspace=client"
